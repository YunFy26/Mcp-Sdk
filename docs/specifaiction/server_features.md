### 概述
服务器通过模型上下文协议（MCP）为语言模型增添上下文提供了基本构建块。这些基本元素支持客户端、服务器和语言模型之间的丰富交互：
- 提示词（Prompts）：预定义的模板或指令，用于指导语言模型的交互
- 资源（Resources）：为模型提供额外上下文的结构化数据或内容
- 工具（Tools）：可执行的函数，让模型能够执行操作或检索信息

每种基本元素可通过以下控制层级进行概述：

| 基本元素 | 控制方式   | 描述               | 示例              |
|------|--------|------------------|-----------------|
| 提示词  | 用户控制   | 由用户选择调用的交互式模板    | 斜杠命令、菜单选项       |
| 资源   | 应用程序控制 | 由客户端附加和管理的上下文数据  | 文件内容、git历史记录    |
| 工具   | 模型控制   | 向LLM开放的用于执行操作的函数 | API POST请求、文件写入 |

### Prompts
模型上下文协议（MCP）为服务器向客户端暴露提示词模板提供了标准化方式。提示词让服务器能够提供结构化消息和指令，用于与语言模型交互。
客户端可以发现可用的提示词、获取其内容，并通过提供参数对其进行自定义。


#### 1. 用户交互模式
提示词设计为**用户控制**模式，即服务器向客户端暴露提示词时，旨在让用户能够明确选择使用。
通常，提示词通过用户在界面中主动发起的命令触发，这种方式便于用户自然地发现和调用可用的提示词。


### 功能声明
支持提示词功能的服务器**必须**在初始化时声明`prompts`能力：
```json
{
  "capabilities": {
    "prompts": {
      "listChanged": true
    }
  }
}
```
其中，`listChanged`表示当可用提示词列表发生变化时，服务器是否会发送通知。


### 协议消息
#### 列出提示词
客户端如需获取可用提示词，需发送`prompts/list`请求。此操作支持分页。

**请求示例**：
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "prompts/list",
  "params": {
    "cursor": "optional-cursor-value"  // 可选的分页游标
  }
}
```

**响应示例**：
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "prompts": [
      {
        "name": "code_review",  // 提示词唯一标识
        "title": "请求代码审查",  // 用于展示的名称（可选）
        "description": "让大语言模型分析代码质量并提出改进建议",  // 描述（可选）
        "arguments": [  // 自定义参数列表（可选）
          {
            "name": "code",  // 参数名
            "description": "需要审查的代码",  // 参数描述
            "required": true  // 是否为必填参数
          }
        ]
      }
    ],
    "nextCursor": "next-page-cursor"  // 下一页游标（用于分页）
  }
}
```


#### 获取特定提示词
客户端如需获取某个特定提示词，需发送`prompts/get`请求。参数可通过补全API自动补全。

**请求示例**：
```json
{
  "jsonrpc": "2.0",
  "id": 2,
  "method": "prompts/get",
  "params": {
    "name": "code_review",  // 目标提示词的唯一标识
    "arguments": {  // 传入的参数
      "code": "def hello():\n    print('world')"
    }
  }
}
```

**响应示例**：
```json
{
  "jsonrpc": "2.0",
  "id": 2,
  "result": {
    "description": "代码审查提示词",  // 提示词描述
    "messages": [  // 提示词包含的消息列表
      {
        "role": "user",  // 角色（用户或助手）
        "content": {
          "type": "text",  // 内容类型
          "text": "请审查这段Python代码：\ndef hello():\n    print('world')"  // 具体内容
        }
      }
    ]
  }
}
```


#### 列表变更通知
当可用提示词列表发生变化时，已声明`listChanged`能力的服务器**应**发送如下通知：
```json
{
  "jsonrpc": "2.0",
  "method": "notifications/prompts/list_changed"
}
```


### 消息流程
```
服务器 ←→ 客户端
        （发现阶段）
服务器 → 客户端：提示词列表（通过prompts/list请求触发）
服务器 ←→ 客户端
        （使用阶段）
服务器 → 客户端：特定提示词内容（通过prompts/get请求触发）
服务器 ←→ 客户端
        （变更阶段，可选，基于listChanged能力）
服务器 → 客户端：提示词列表变更通知（notifications/prompts/list_changed）
服务器 → 客户端：更新后的提示词列表（通过prompts/list请求触发）
```


### 数据类型
#### 提示词（Prompt）
提示词定义包含以下字段：
- `name`：提示词的唯一标识符
- `title`：可选，用于展示的人类可读名称
- `description`：可选，人类可读的描述文本
- `arguments`：可选，用于自定义的参数列表


#### 提示词消息（PromptMessage）
提示词中的消息包含以下字段：
- `role`：角色，值为“user”（用户）或“assistant”（助手），用于标识发言者
- `content`：内容，支持以下类型：

    1. **文本内容（Text Content）**  
       表示纯文本消息：
       ```json
       {
         "type": "text",
         "text": "消息的文本内容"
       }
       ```
       这是自然语言交互中最常用的内容类型。

    2. **图片内容（Image Content）**  
       允许在消息中包含视觉信息：
       ```json
       {
         "type": "image",
         "data": "base64编码的图片数据",
         "mimeType": "image/png"  // 图片的MIME类型
       }
       ```
       图片数据**必须**经过base64编码，并包含有效的MIME类型。这支持需要视觉上下文的多模态交互。

    3. **音频内容（Audio Content）**  
       允许在消息中包含音频信息：
       ```json
       {
         "type": "audio",
         "data": "base64编码的音频数据",
         "mimeType": "audio/wav"  // 音频的MIME类型
       }
       ```
       音频数据**必须**经过base64编码，并包含有效的MIME类型。这支持需要音频上下文的多模态交互。

    4. **嵌入式资源（Embedded Resources）**  
       允许在消息中直接引用服务器端资源：
       ```json
       {
         "type": "resource",
         "resource": {
           "uri": "resource://example",  // 资源的URI
           "name": "example",  // 资源名称
           "title": "我的示例资源",  // 资源标题
           "mimeType": "text/plain",  // 资源的MIME类型
           "text": "资源内容"  // 资源的文本内容
         }
       }
       ```
       资源可包含文本或二进制（blob）数据，且**必须**包含：
    - 有效的资源URI
    - 对应的MIME类型
    - 文本内容或base64编码的二进制数据

  嵌入式资源使提示词能够将服务器管理的内容（如文档、代码示例或其他参考资料）无缝整合到对话流程中。


### 错误处理
服务器**应**针对常见失败场景返回标准JSON-RPC错误：
- 无效的提示词名称：`-32602`（无效参数）
- 缺少必填参数：`-32602`（无效参数）
- 内部错误：`-32603`（内部错误）


### 实现注意事项
- 服务器**应**在处理前验证提示词参数
- 客户端**应**处理大型提示词列表的分页逻辑
- 双方**应**遵守能力协商机制


### 安全性
实现时**必须**仔细验证所有提示词的输入和输出，以防止注入攻击或未授权访问资源。